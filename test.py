# app.py
import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
from collections import defaultdict

st.set_page_config(page_title="학교 생활 밸런스 게임", page_icon="👸", layout="centered")
st.title("👑 학교 생활 밸런스 게임")
st.write("엉뚱하고 웃긴 질문들에 답하면서, 당신의 학교 생활 유형을 알아보세요!")

# 질문 리스트
questions = [
    ("시험 전날, 당신의 선택은?", ["밤새 벼락치기 → 시험지 보자마자 뇌 정지", "그냥 자고 꿈속에서 시험지 미리 풀어본다"]),
    ("체육시간, 당신의 선택은?", ["달리기 결승선에서 포즈", "체육복만 입고 그늘에서 바람 쐬기"]),
    ("쉬는 시간에 나는...", ["자리에서 조용히 책 보기", "복도에서 갑자기 댄스 파티 시작"]),
    ("과제 제출, 당신의 방식은?", ["마감 3일 전 제출", "선생님이 부를 때까지 잠수"]),
    ("시험 끝난 날, 나는...", ["바로 복습 시작", "게임·넷플릭스 정주행 몰아보기"]),
    ("교실에 에어컨이 고장 났을 때", ["선생님께 민원 넣고 해결 시도", "부채질로 버티며 여름을 승화"]),
    ("급식 대기 줄에서 나는?", ["메뉴 분석 후 최적 동선 공략", "친구들과 수다에 몰입"])
]

# 답변별 점수
answer_scores = {
    "밤새 벼락치기 → 시험지 보자마자 뇌 정지": {"모범생 3000 ✏️": 2, "지식 폭격기 📚": 1},
    "그냥 자고 꿈속에서 시험지 미리 풀어본다": {"잠꾸러기 고라니 😴": 2, "숨은 게이머 🎮": 1},
    "달리기 결승선에서 포즈": {"체육관 파이터 🥊": 2, "급발진 인싸 🚀": 1},
    "체육복만 입고 그늘에서 바람 쐬기": {"잠꾸러기 고라니 😴": 1, "환경 지키미 🌱": 1},
    "자리에서 조용히 책 보기": {"모범생 3000 ✏️": 1, "지식 폭격기 📚": 2},
    "복도에서 갑자기 댄스 파티 시작": {"복도 아이돌 🎤": 2, "급발진 인싸 🚀": 1},
    "마감 3일 전 제출": {"모범생 3000 ✏️": 2, "지식 폭격기 📚": 1},
    "선생님이 부를 때까지 잠수": {"숨은 게이머 🎮": 1, "급발진 인싸 🚀": 1},
    "바로 복습 시작": {"모범생 3000 ✏️": 2, "지식 폭격기 📚": 1},
    "게임·넷플릭스 정주행 몰아보기": {"숨은 게이머 🎮": 2, "급발진 인싸 🚀": 1},
    "선생님께 민원 넣고 해결 시도": {"환경 지키미 🌱": 2, "모범생 3000 ✏️": 1},
    "부채질로 버티며 여름을 승화": {"잠꾸러기 고라니 😴": 1, "급발진 인싸 🚀": 1},
    "메뉴 분석 후 최적 동선 공략": {"급식 요정 🍱": 2, "모범생 3000 ✏️": 1},
    "친구들과 수다에 몰입": {"급식 요정 🍱": 1, "복도 아이돌 🎤": 1, "급발진 인싸 🚀": 1},
}

# 유형별 설명 (200자 이상, 귀여운 이모지 포함)
descriptions = {
    "모범생 3000 ✏️": "👑📚 항상 칠판 앞자리를 차지하며 필기와 복습을 철저히 하는 당신! 선생님이 말하기도 전에 답을 알고 있고, 시험 기간엔 친구들의 비밀 무기 같은 존재예요. 공부와 계획이 생활의 중심이라 가끔은 기계처럼 느껴지기도 하지만, 사실은 모두가 의지하는 든든한 반의 지식 보물 창고랍니다!",
    "급식 요정 🍱": "🍱👸 점심시간 종이 울리자마자 누구보다 빠르게 달려가 급식 줄 선두를 차지하는 당신! 메뉴판만 봐도 행복지수가 폭발하고, 맛있는 반찬이 나오면 온 반에 소문을 퍼뜨리는 급식 홍보대사예요. 음식 앞에서는 눈이 반짝이며, 친구들과 수다 떨며 먹는 급식 시간이 하루 중 가장 빛나는 순간이죠!",
    "복도 아이돌 🎤": "🎤🌸 쉬는 시간이 되면 교실 복도는 당신의 콘서트장이 됩니다! 갑자기 춤을 추거나 노래를 흥얼거려도 분위기를 띄우는 능력은 천부적이에요. 친구들이 웃고 박수치는 순간, 이미 당신은 스타! 수업이 끝나면 ‘오늘 무대 어땠어?’라는 팬미팅급 피드백을 받는 것도 일상인, 반의 아이돌이랍니다!",
    "숨은 게이머 🎮": "🎮👑 평소에는 조용하고 존재감이 크지 않지만, 종이 치는 순간부터 당신은 게이머 세계의 전사로 변신! 게임 속에서 전략과 순발력을 발휘하며, 현실에서는 보여주지 않는 다른 모습을 펼쳐 보입니다. 공부보다 레벨업에 더 진심이고, 가끔 시험지 대신 게임 공략이 머릿속을 차지하죠!",
    "잠꾸러기 고라니 😴": "😴💤 수업 종이 울리면 눈꺼풀이 무거워지고, 교실 책상은 당신의 포근한 베개로 변합니다. 졸음과 함께하는 학교생활이지만, 놀라울 정도로 시험 직전에는 집중력을 발휘하는 반전 매력의 소유자예요. 친구들은 ‘고라니’라 놀리지만, 사실 당신의 평화로운 기운 덕분에 반 분위기가 한결 부드러워집니다!",
    "지식 폭격기 📚": "📚🦄 질문이 떠오르면 바로 손을 들어 선생님도 긴장하게 만드는 당신! 교과서에 없는 지식까지 줄줄 외워 친구들의 감탄을 자아냅니다. ‘이건 왜 그런 건가요?’라는 말 한마디에 수업이 길어지는 건 당신의 특기. 똑똑하면서도 엉뚱한 면이 있어, 반에서는 무심코 던진 말이 밈이 되기도 해요!",
    "체육관 파이터 🥊": "🥊🌟 체육 시간이 다가오면 에너지가 폭발하는 당신! 달리기, 농구, 배드민턴 등 뭐든 자신 있게 도전하고 승부욕이 넘칩니다. 교실에서는 잠잠하지만, 체육관에만 가면 180도 달라져 반 친구들을 놀라게 해요. 운동 후 땀에 젖은 모습조차도 열정의 상징인, 반의 스포츠 전사랍니다!",
    "환경 지키미 🌱": "🌱🌷 교내 분리수거를 철저히 하고, 종이를 아끼자고 외치는 환경 히어로! 작은 실천도 무시하지 않고, 친구들에게도 친환경 습관을 전파합니다. 에어컨이 고장 나면 민원도 넣고, 창문 환기도 빠뜨리지 않아요. 덕분에 반은 늘 쾌적하고, 당신은 조용히 모두를 지켜주는 학교의 초록빛 수호자랍니다!",
    "급발진 인싸 🚀": "🚀🎉 평소엔 얌전하다가도 어느 순간 갑자기 폭발하는 인싸력! 분위기 메이커로 반 친구들을 웃기거나, 예상 못 한 행동으로 모두를 놀라게 합니다. 한순간의 급발진으로 반 분위기가 살아나고, 그 에너지 덕분에 늘 재미있는 사건이 생기죠. 당신은 학교 생활의 예측 불가형 엔터테이너예요!"
}

princess_emojis = {
    "모범생 3000 ✏️": "👑📚✨",
    "급식 요정 🍱": "🍰👸💖",
    "복도 아이돌 🎤": "🎤👑🌸",
    "숨은 게이머 🎮": "🕹️👸🎀",
    "잠꾸러기 고라니 😴": "😴👑💤",
    "지식 폭격기 📚": "📚👸🦄",
    "체육관 파이터 🥊": "🥊👑🌟",
    "환경 지키미 🌱": "🌱👸🌷",
    "급발진 인싸 🚀": "🚀👑🎉"
}

# 점수 기록
scores = defaultdict(int)

st.header("📝 질문")
for i, (q, opts) in enumerate(questions):
    answer = st.radio(f"{i+1}. {q}", opts, index=None, key=f"q{i}")
    if answer:
        for typ, pts in answer_scores[answer].items():
            scores[typ] += pts

if st.button("🎉 결과 보기"):
    if not scores:
        st.info("질문에 답변을 선택해주세요!")
    else:
        best_type = max(scores, key=scores.get)
        emoji = princess_emojis.get(best_type, "")
        st.subheader("🏆 당신의 학교 생활 유형은...")
        st.markdown(f"## {emoji} {best_type} {emoji}", unsafe_allow_html=True)
        st.write(descriptions[best_type])

        # 시각화 (연분홍 바 차트)
        st.subheader("📊 유형별 점수 현황")
        df = pd.DataFrame(scores.items(), columns=["유형", "점수"]).sort_values(by="점수", ascending=True)

        fig, ax = plt.subplots(figsize=(8, 6))
        bars = ax.barh(df["유형"], df["점수"], color="#FFB6C1", edgecolor="black")  # 연분홍색
        ax.set_xlabel("점수", fontsize=12)
        ax.set_title_
